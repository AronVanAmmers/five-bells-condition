<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Crypto-Conditions</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terminology"/>
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Features"/>
<link href="#rfc.section.1.2.1" rel="Chapter" title="1.2.1 Multi-Algorithm"/>
<link href="#rfc.section.1.2.2" rel="Chapter" title="1.2.2 Multi-Signature"/>
<link href="#rfc.section.1.2.3" rel="Chapter" title="1.2.3 Multi-Level"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Format"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Binary Encoding"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 String Types"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Bitmask"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Condition"/>
<link href="#rfc.section.2.4.1" rel="Chapter" title="2.4.1 String"/>
<link href="#rfc.section.2.4.2" rel="Chapter" title="2.4.2 Binary Format"/>
<link href="#rfc.section.2.5" rel="Chapter" title="2.5 Fulfillment"/>
<link href="#rfc.section.2.5.1" rel="Chapter" title="2.5.1 String Format"/>
<link href="#rfc.section.2.5.2" rel="Chapter" title="2.5.2 Binary Format"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Feature Suites"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 SHA-256"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 PREIMAGE"/>
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 PREFIX"/>
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 THRESHOLD"/>
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 RSA-PSS"/>
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 ED25519"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Condition Types"/>
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 PREIMAGE-SHA-256"/>
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Condition"/>
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Fulfillment"/>
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 PREFIX-SHA-256"/>
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Condition"/>
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 Fulfillment"/>
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 THRESHOLD-SHA-256"/>
<link href="#rfc.section.4.3.1" rel="Chapter" title="4.3.1 Condition"/>
<link href="#rfc.section.4.3.2" rel="Chapter" title="4.3.2 Fulfillment"/>
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 RSA-SHA-256"/>
<link href="#rfc.section.4.4.1" rel="Chapter" title="4.4.1 Condition"/>
<link href="#rfc.section.4.4.2" rel="Chapter" title="4.4.2 Fulfillment"/>
<link href="#rfc.section.4.4.3" rel="Chapter" title="4.4.3 Implementation"/>
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 ED25519"/>
<link href="#rfc.section.4.5.1" rel="Chapter" title="4.5.1 Condition"/>
<link href="#rfc.section.4.5.2" rel="Chapter" title="4.5.2 Fulfillment"/>
<link href="#rfc.section.4.5.3" rel="Chapter" title="4.5.3 Implementation"/>
<link href="#rfc.references" rel="Chapter" title="5 References"/>
<link href="#rfc.references.1" rel="Chapter" title="5.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="5.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Security Considerations"/>
<link href="#rfc.appendix.B" rel="Chapter" title="B Test Values"/>
<link href="#rfc.appendix.C" rel="Chapter" title="C ASN.1 Module"/>
<link href="#rfc.appendix.D" rel="Chapter" title="D Acknowledgements"/>
<link href="#rfc.appendix.E" rel="Chapter" title="E IANA Considerations"/>
<link href="#rfc.appendix.E.1" rel="Chapter" title="E.1 Crypto-Condition Type Registry"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.1 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Thomas, S." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-thomas-crypto-conditions-01" />
  <meta name="dct.issued" scheme="ISO8601" content="2016-3" />
  <meta name="dct.abstract" content="Crypto-conditions provide a mechanism to describe a signed message such that multiple actors in a distributed system can all verify the same signed message and agree on whether it matches the description.  This provides a useful primitive for event-based systems that are distributed on the Internet since we can describe events in a standard deterministic manner (represented by signed messages) and therefore define generic authenticated event handlers.  " />
  <meta name="description" content="Crypto-conditions provide a mechanism to describe a signed message such that multiple actors in a distributed system can all verify the same signed message and agree on whether it matches the description.  This provides a useful primitive for event-based systems that are distributed on the Internet since we can describe events in a standard deterministic manner (represented by signed messages) and therefore define generic authenticated event handlers.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">S. Thomas</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Ripple</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">March 2016</td>
</tr>
<tr>
  <td class="left">Expires: September 2, 2016</td>
  <td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Crypto-Conditions<br />
  <span class="filename">draft-thomas-crypto-conditions-01</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>Crypto-conditions provide a mechanism to describe a signed message such that multiple actors in a distributed system can all verify the same signed message and agree on whether it matches the description.  This provides a useful primitive for event-based systems that are distributed on the Internet since we can describe events in a standard deterministic manner (represented by signed messages) and therefore define generic authenticated event handlers.  </p>
<h1>
  <a>Feedback</a>
</h1>
<p>This specification is a part of the <a href="https://interledger.org/">Interledger Protocol</a> work. Feedback related to this specification should be sent to <a href="mailto:public-interledger@w3.org">public-interledger@w3.org</a>.  </p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 2, 2016.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2016 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Terminology</a></li>
<li>1.2.   <a href="#rfc.section.1.2">Features</a></li>
<ul><li>1.2.1.   <a href="#rfc.section.1.2.1">Multi-Algorithm</a></li>
<li>1.2.2.   <a href="#rfc.section.1.2.2">Multi-Signature</a></li>
<li>1.2.3.   <a href="#rfc.section.1.2.3">Multi-Level</a></li>
</ul></ul><li>2.   <a href="#rfc.section.2">Format</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Binary Encoding</a></li>
<li>2.2.   <a href="#rfc.section.2.2">String Types</a></li>
<li>2.3.   <a href="#rfc.section.2.3">Bitmask</a></li>
<li>2.4.   <a href="#rfc.section.2.4">Condition</a></li>
<ul><li>2.4.1.   <a href="#rfc.section.2.4.1">String</a></li>
<li>2.4.2.   <a href="#rfc.section.2.4.2">Binary Format</a></li>
</ul><li>2.5.   <a href="#rfc.section.2.5">Fulfillment</a></li>
<ul><li>2.5.1.   <a href="#rfc.section.2.5.1">String Format</a></li>
<li>2.5.2.   <a href="#rfc.section.2.5.2">Binary Format</a></li>
</ul></ul><li>3.   <a href="#rfc.section.3">Feature Suites</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">SHA-256</a></li>
<li>3.2.   <a href="#rfc.section.3.2">PREIMAGE</a></li>
<li>3.3.   <a href="#rfc.section.3.3">PREFIX</a></li>
<li>3.4.   <a href="#rfc.section.3.4">THRESHOLD</a></li>
<li>3.5.   <a href="#rfc.section.3.5">RSA-PSS</a></li>
<li>3.6.   <a href="#rfc.section.3.6">ED25519</a></li>
</ul><li>4.   <a href="#rfc.section.4">Condition Types</a></li>
<ul><li>4.1.   <a href="#rfc.section.4.1">PREIMAGE-SHA-256</a></li>
<ul><li>4.1.1.   <a href="#rfc.section.4.1.1">Condition</a></li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">Fulfillment</a></li>
</ul><li>4.2.   <a href="#rfc.section.4.2">PREFIX-SHA-256</a></li>
<ul><li>4.2.1.   <a href="#rfc.section.4.2.1">Condition</a></li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">Fulfillment</a></li>
</ul><li>4.3.   <a href="#rfc.section.4.3">THRESHOLD-SHA-256</a></li>
<ul><li>4.3.1.   <a href="#rfc.section.4.3.1">Condition</a></li>
<li>4.3.2.   <a href="#rfc.section.4.3.2">Fulfillment</a></li>
</ul><li>4.4.   <a href="#rfc.section.4.4">RSA-SHA-256</a></li>
<ul><li>4.4.1.   <a href="#rfc.section.4.4.1">Condition</a></li>
<li>4.4.2.   <a href="#rfc.section.4.4.2">Fulfillment</a></li>
<li>4.4.3.   <a href="#rfc.section.4.4.3">Implementation</a></li>
</ul><li>4.5.   <a href="#rfc.section.4.5">ED25519</a></li>
<ul><li>4.5.1.   <a href="#rfc.section.4.5.1">Condition</a></li>
<li>4.5.2.   <a href="#rfc.section.4.5.2">Fulfillment</a></li>
<li>4.5.3.   <a href="#rfc.section.4.5.3">Implementation</a></li>
</ul></ul><li>5.   <a href="#rfc.references">References</a></li>
<ul><li>5.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>5.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Security Considerations</a></li>
<li>Appendix B.   <a href="#rfc.appendix.B">Test Values</a></li>
<li>Appendix C.   <a href="#rfc.appendix.C">ASN.1 Module</a></li>
<li>Appendix D.   <a href="#rfc.appendix.D">Acknowledgements</a></li>
<li>Appendix E.   <a href="#rfc.appendix.E">IANA Considerations</a></li>
<ul><li>E.1.   <a href="#rfc.appendix.E.1">Crypto-Condition Type Registry</a></li>
</ul><li><a href="#rfc.authors">Author's Address</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">This specification describes a message format for defining distributable event descriptions (crypto-conditions) and the cryptographically verifiable event messages (fulfillments) that can be used to prove that the event occured.  </p>
<p id="rfc.section.1.p.2">The specification defines both binary and string-based encoding for the messages.  </p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [RFC2119].  </p>
<p id="rfc.section.1.1.p.2">Within this specification, the term "condition" refers to the hash of a description of a signed message.  </p>
<p id="rfc.section.1.1.p.3">The term "fulfillment" refers to a description of a signed message and a signed message that matches the description.  </p>
<p id="rfc.section.1.1.p.4">The description can be hashed and compared to a condition. If the message matches the description and the hash of the description matches the condition, we say that the fulfillment fulfills the condition.  </p>
<p id="rfc.section.1.1.p.5">A "hashlock" is a tuple consisting of a bytestring and its hash where the hash is published first and the publication of the corresponding bytestring acts as a one-bit, one-time signature.  </p>
<h1 id="rfc.section.1.2"><a href="#rfc.section.1.2">1.2.</a> <a href="#features" id="features">Features</a></h1>
<p id="rfc.section.1.2.p.1">Crypto-conditions are a simple multi-algorithm, multi-level, multi-signature standard format for expressing conditions and fulfillments.  </p>
<h1 id="rfc.section.1.2.1"><a href="#rfc.section.1.2.1">1.2.1.</a> <a href="#multi-algorithm" id="multi-algorithm">Multi-Algorithm</a></h1>
<p id="rfc.section.1.2.1.p.1">Crypto-conditions can support several different signature and hash algorithms and support for new ones can be added in the future.  </p>
<p id="rfc.section.1.2.1.p.2">Implementations can state their supported algorithms simply by providing a bitmask. It is easy to verify that a given implementation will be able to verify the fulfillment to a given condition, by verifying that all bits that are set in the condition's bitmask are also set in the implementation's supported features bitmask.  </p>
<p id="rfc.section.1.2.1.p.3">Any new high bit can redefine the meaning of any existing lower bits when it is set. This can be used to remove obsolete algorithms.  </p>
<p id="rfc.section.1.2.1.p.4">The bitmask is encoded as a varint to minimize space usage.  </p>
<p id="rfc.section.1.2.1.p.5">By evaluating the bitmask of a condition actors in the system can establish, even beforea fulfillment is published, if they will be able to verify the fulfilment.  </p>
<h1 id="rfc.section.1.2.2"><a href="#rfc.section.1.2.2">1.2.2.</a> <a href="#multi-signature" id="multi-signature">Multi-Signature</a></h1>
<p id="rfc.section.1.2.2.p.1">Crypto-conditions can abstract away many of the details of multi-sign. When a party provides a condition, other parties can treat it opaquely and do not need to know about its internal structure. That allows parties to define arbitrary multi-signature setups without breaking compatibility.  </p>
<p id="rfc.section.1.2.2.p.2">Protocol designers can use crypto-conditions as a drop-in replacement for public key signature algorithms and add multi-signature support to their protocols without adding any additional complexity.  </p>
<h1 id="rfc.section.1.2.3"><a href="#rfc.section.1.2.3">1.2.3.</a> <a href="#multi-level" id="multi-level">Multi-Level</a></h1>
<p id="rfc.section.1.2.3.p.1">Basic multi-sign is single-level and does not support more complex trust relationships such as "I trust Alice and Bob, but only when Candice also agrees". In single level 2-of-3 Alice and Bob could sign on their own, without Candice's approval.  </p>
<p id="rfc.section.1.2.3.p.2">Crypto-conditions add that flexibility elegantly, by applying thresholds not just to signatures, but to conditions which can be signatures or further conditions. That allows the creation of an arbitrary threshold boolean circuit of signatures.  </p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#format" id="format">Format</a></h1>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#binary-encoding" id="binary-encoding">Binary Encoding</a></h1>
<p id="rfc.section.2.1.p.1">An description of crypto-conditions is provided in this document using Abstract Syntax Notation One (ASN.1) as defined in <a href="#ITU.X680.2015">[ITU.X680.2015]</a>. Implementations of this spec MUST support encoding and decoding using Octet Encoding Rules (OER) as defined in <a href="#ITU.X696.2015">[ITU.X696.2015]</a>.  </p>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#string-types" id="string-types">String Types</a></h1>
<p/>

<dl>
  <dt>BASE10</dt>
  <dd style="margin-left: 8">Variable-length integer encoded as a base-10 (decimal) number. Implementations MUST reject encodings that are too large for them to parse. Implementations MUST be tested for overflows.  </dd>
  <dt>BASE16</dt>
  <dd style="margin-left: 8">Variable-length integer encoded as a base-16 (hexadecimal) number. Implementations MUST reject encodings that are too large for them to parse. Implementations MUST be tested for overflows. No leading zeros.  </dd>
  <dt>BASE64URL</dt>
  <dd style="margin-left: 8">Base64-URL encoding. See <a href="#RFC4648">[RFC4648]</a>, Section 5.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#bitmask" id="bitmask">Bitmask</a></h1>
<p id="rfc.section.2.3.p.1">Any system accepting crypto-conditions must be able to state its supported algorithms. It must be possible to verify that all algorithms used in a certain condition are indeed supported even if the fulfillment is not available yet.  </p>
<p id="rfc.section.2.3.p.2">In order to meet these design goals, we define a bitmask to express the supported primitives.  </p>
<p id="rfc.section.2.3.p.3">Each bit represents a different suite of features. Each type of condition depends on one or more feature suites. If an implementation supports all feature suites that a certain type depends on, the implementation MUST support that condition type. The list of known types and feature suites is the IANA maintained <a href="#crypto-conditions-type-registry">Crypto-Condition Type Registry</a> <cite title="NONE">[crypto-conditions-type-registry]</cite>.  </p>
<p id="rfc.section.2.3.p.4">Conditions contain a bitmask of types which they require the implementation to support.  Implementations provide a bitmask of types they support.  </p>
<h1 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#condition-format" id="condition-format">Condition</a></h1>
<p id="rfc.section.2.4.p.1">Below are the string and binary encoding formats for a condition. In both, the featureBitmask is the boolean OR of the featureBitmask of the top-level condition type and all subcondition types, recursively.  </p>
<h1 id="rfc.section.2.4.1"><a href="#rfc.section.2.4.1">2.4.1.</a> <a href="#string-condition-format" id="string-condition-format">String</a></h1>
<p>Conditions are ASCII encoded as: </p>
<pre>
"cc:" BASE10(type) ":" BASE16(featureBitmask) ":"
    BASE64URL(fingerprint) ":" BASE10(maxFulfillmentLength)
                     </pre>
<h1 id="rfc.section.2.4.2"><a href="#rfc.section.2.4.2">2.4.2.</a> <a href="#binary-condition-format" id="binary-condition-format">Binary Format</a></h1>
<p>Conditions are binary encoded as: </p>
<pre>
Condition ::= SEQUENCE {
  type ConditionType,
  featureBitmask OCTET STRING,
  fingerprint OCTET STRING,
  maxFulfillmentLength INTEGER (0..MAX)
}

ConditionType ::= INTEGER {
  preimageSha256(0),
  rsaSha256(1),
  prefixSha256(2),
  thresholdSha256(3),
  ed25519(4)
} (0..65535)
                     </pre>
<p id="rfc.section.2.4.2.p.1">type is the condition type ID.  </p>
<p id="rfc.section.2.4.2.p.2">featureBitmask is the set of required features in order to parse the fulfillment to this condition.  </p>
<p id="rfc.section.2.4.2.p.3">fingerprint is the unique identifier of the condition. For most condition types, this is a hash.  </p>
<p id="rfc.section.2.4.2.p.4">maxFulfillmentLength is the maximum length of the fulfillment payload that can fulfill this condition. When a crypto-condition is submitted to an implementation, this implementation MUST verify that it will be able to process a fulfillment with a payload of size maxFulfillmentLength.  </p>
<h1 id="rfc.section.2.5"><a href="#rfc.section.2.5">2.5.</a> <a href="#fulfillment-format" id="fulfillment-format">Fulfillment</a></h1>
<p id="rfc.section.2.5.p.1">Below are the string and binary encoding formats for a fulfillment. In both the TYPE_ID is the numeric type identifier representing the top level condition type.  </p>
<h1 id="rfc.section.2.5.1"><a href="#rfc.section.2.5.1">2.5.1.</a> <a href="#string-fulfillment-format" id="string-fulfillment-format">String Format</a></h1>
<p>Fulfillments are ASCII encoded as: </p>
<pre>
"cf:" BASE16(TYPE_ID) ":" BASE64URL(FULFILLMENT_PAYLOAD)
                     </pre>
<h1 id="rfc.section.2.5.2"><a href="#rfc.section.2.5.2">2.5.2.</a> <a href="#binary-fulfillment-format" id="binary-fulfillment-format">Binary Format</a></h1>
<p>Fulfillments are binary encoded as: </p>
<pre>
Fulfillment ::= SEQUENCE {
  type ConditionType,
  payload OCTET STRING
}
                     </pre>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#feature-suites" id="feature-suites">Feature Suites</a></h1>
<p id="rfc.section.3.p.1">The following feature suites are defined in this version of the specification. New feature suites may be defined in the future and will be registered in the IANA maintained <a href="#crypto-conditions-type-registry">Crypto-Condition Type Registry</a> <cite title="NONE">[crypto-conditions-type-registry]</cite> </p>
<p id="rfc.section.3.p.2">Support for a condition MUST depend on one or more feature suites. Future versions of this spec MAY introduce new feature bits and condition types. However, all new condition types MUST always depend on at least one of the new feature suites. This ensures that all previously creates implementations correctly signal that they do not support the new type.  </p>
<p id="rfc.section.3.p.3">Feature suites are chosen such that they represent reasonable clusters of functionality.  For instance, it is reasonable to require that an implementation which supports SHA-256 in one context MUST support it in all contexts, since it already needed to implement the algorithm.  </p>
<p id="rfc.section.3.p.4">An implementation which supports a certain set of feature suites MUST accept all condition types which depend only on that set or any subset of feature suites.  </p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#sha-256-feature-suite" id="sha-256-feature-suite">SHA-256</a></h1>
<p id="rfc.section.3.1.p.1">SHA-256 is a hashing algorithm and is assigned the feature bit 2^0 = 0x01.  </p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#preimage-feature-suite" id="preimage-feature-suite">PREIMAGE</a></h1>
<p id="rfc.section.3.2.p.1">PREIMAGE refers to hashlock conditions and is assigned the feature bit 2^1 = 0x02.  </p>
<p id="rfc.section.3.2.p.2">A preimage condition is the hash of its own fulfillment. In order to fulfill a preimage condition, a valid preimage must be provided.  </p>
<p id="rfc.section.3.2.p.3">Preimage conditions can be used as a so-called hashlock. Since cryptographically secure hashing functions are preimage-resistant, only the original creator of a preimage condition can feasibly produce the preimage if it contains a large amount of random entropy.  </p>
<h1 id="rfc.section.3.3"><a href="#rfc.section.3.3">3.3.</a> <a href="#prefix-feature-suite" id="prefix-feature-suite">PREFIX</a></h1>
<p id="rfc.section.3.3.p.1">PREFIX is a structural condition and is assigned the feature bit 2^2 = 0x04.  </p>
<p id="rfc.section.3.3.p.2">A prefix condition condition contains exactly one subcondition. When validated it simply prepends the message to be validated with a constant string before passing it on to the subcondition's validation function.  </p>
<h1 id="rfc.section.3.4"><a href="#rfc.section.3.4">3.4.</a> <a href="#threshold-feature-suite" id="threshold-feature-suite">THRESHOLD</a></h1>
<p id="rfc.section.3.4.p.1">THRESHOLD is a structural condition and is assigned the feature bit 2^3 = 0x08.  </p>
<p id="rfc.section.3.4.p.2">Threshold conditions provide a way to create m-of-n threshold combinations of other conditions such that m of the n subconditions have to be fulfilled in order for the threshold condition to be fulfilled.  </p>
<p id="rfc.section.3.4.p.3">Weights are also supported which allow one subcondition to count as multiple fulfilled subconditions towards the threshold.  </p>
<h1 id="rfc.section.3.5"><a href="#rfc.section.3.5">3.5.</a> <a href="#rsa-pss-feature-suite" id="rsa-pss-feature-suite">RSA-PSS</a></h1>
<p id="rfc.section.3.5.p.1">RSA-PSS is a signature algorithm and is assigned the feature bit 2^4 = 0x10.  </p>
<h1 id="rfc.section.3.6"><a href="#rfc.section.3.6">3.6.</a> <a href="#ed25519-feature-suite" id="ed25519-feature-suite">ED25519</a></h1>
<p id="rfc.section.3.6.p.1">ED25519 is a signature algorithm and is assigned the feature bit 2^5 = 0x20.  </p>
<p id="rfc.section.3.6.p.2">ED25519 is a compact elliptic curve based signature algorithm.  </p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#condition-types" id="condition-types">Condition Types</a></h1>
<p id="rfc.section.4.p.1">The following condition types are defined in this version of the specification. New types may be defined in the future and will be registered in the IANA maintained <a href="#crypto-conditions-type-registry">Crypto-Condition Type Registry</a> <cite title="NONE">[crypto-conditions-type-registry]</cite> </p>
<h1 id="rfc.section.4.1"><a href="#rfc.section.4.1">4.1.</a> <a href="#preimage-sha-256-condition-type" id="preimage-sha-256-condition-type">PREIMAGE-SHA-256</a></h1>
<p id="rfc.section.4.1.p.1">PREIMAGE-SHA-256 is assigned the type ID 0. It relies on the SHA-256 and PREIMAGE feature suites which corresponds to a feature bitmask of 0x03.  </p>
<p id="rfc.section.4.1.p.2">This type of condition is also called a hashlock. By creating a hash of a difficult-to-guess 256-bit random or pseudo-random integer it is possible to create a condition which the creator can trivially fulfill by publishing the random value. However, for anyone else, the condition is cryptgraphically hard to fulfill, because they would have to find a preimage for the given condition hash.  </p>
<p id="rfc.section.4.1.p.3">Bitcoin supports this type of condition via the OP_HASH256 operator.  </p>
<h1 id="rfc.section.4.1.1"><a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#preimage-sha-256-condition-type-condition" id="preimage-sha-256-condition-type-condition">Condition</a></h1>
<p id="rfc.section.4.1.1.p.1">The fingerprint of a PREIMAGE-SHA-256 condition is the SHA-256 hash of the preimage.  </p>
<h1 id="rfc.section.4.1.2"><a href="#rfc.section.4.1.2">4.1.2.</a> <a href="#preimage-sha-256-condition-type-fulfillment" id="preimage-sha-256-condition-type-fulfillment">Fulfillment</a></h1>
<p id="rfc.section.4.1.2.p.1">The fulfillment payload of a PREIMAGE-SHA-256 condition is the preimage.  </p>
<h1 id="rfc.section.4.2"><a href="#rfc.section.4.2">4.2.</a> <a href="#prefix-sha-256-condition-type" id="prefix-sha-256-condition-type">PREFIX-SHA-256</a></h1>
<p id="rfc.section.4.2.p.1">PREFIX-SHA-256 is assigned the type ID 1. It relies on the SHA-256 and PREFIX feature suites which corresponds to a feature bitmask of 0x05.  </p>
<h1 id="rfc.section.4.2.1"><a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#prefix-sha-256-condition-type-condition" id="prefix-sha-256-condition-type-condition">Condition</a></h1>
<p id="rfc.section.4.2.1.p.1">The fingerprint of a PREFIX-SHA-256 condition is the SHA-256 digest of the fingerprint contents given below: </p>
<pre>
PrefixSha256FingerprintContents ::= SEQUENCE {
  prefix OCTET STRING,
  condition Condition
}
                     </pre>
<p id="rfc.section.4.2.1.p.2">The TYPE_ID is 1. The reason we need this field is because prefix conditions are a structural condition. Structural conditions can have subconditions, meaning their featureBitmask can have multiple bits set, including other structural conditions.  The TYPE_ID makes it very unlikely that two different structural fulfillments could ever generate the exact same condition.  </p>
<p id="rfc.section.4.2.1.p.3">PREFIX is an arbitrary octet string. When the prefix fulfillment is validated, it will prepend the prefix to the provided message and pass the result as the message to the subfulfillment.  </p>
<h1 id="rfc.section.4.2.2"><a href="#rfc.section.4.2.2">4.2.2.</a> <a href="#prefix-sha-256-condition-type-fulfillment" id="prefix-sha-256-condition-type-fulfillment">Fulfillment</a></h1>
<pre>
PrefixSha256FulfillmentPayload ::= SEQUENCE {
  prefix OCTET STRING,
  subfulfillment Fulfillment
}
                     </pre>
<h1 id="rfc.section.4.3"><a href="#rfc.section.4.3">4.3.</a> <a href="#threshold-sha-256-condition-type" id="threshold-sha-256-condition-type">THRESHOLD-SHA-256</a></h1>
<p id="rfc.section.4.3.p.1">THRESHOLD-SHA-256 is assigned the type ID 2. It relies on the SHA-256 and THRESHOLD feature suites which corresponds to a feature bitmask of 0x09.  </p>
<h1 id="rfc.section.4.3.1"><a href="#rfc.section.4.3.1">4.3.1.</a> <a href="#threshold-sha-256-condition-type-condition" id="threshold-sha-256-condition-type-condition">Condition</a></h1>
<p id="rfc.section.4.3.1.p.1">The fingerprint of a THRESHOLD-SHA-256 condition is the SHA-256 digest of the fingerprint contents given below: </p>
<pre>
ThresholdSha256FingerprintContents ::= SEQUENCE {
  threshold INTEGER (0..4294967295),
  subconditions SEQUENCE OF ThresholdSubcondition
}

ThresholdSubcondition ::= SEQUENCE {
  weight INTEGER (0..4294967295),
  condition Condition
}
                     </pre>
<p id="rfc.section.4.3.1.p.2">The type is 2. We need this field because threshold conditions are a structural condition. Structural conditions can have subconditions, meaning their featureBitmask can have multiple bits set, including other structural conditions.  The TYPE_ID makes it very unlikely that two different structural fulfillments could ever generate the exact same condition.  </p>
<p id="rfc.section.4.3.1.p.3">The list of conditions is sorted first based on length, shortest first. Elements of the same length are sorted in lexicographic (big-endian) order, smallest first.  </p>
<h1 id="rfc.section.4.3.2"><a href="#rfc.section.4.3.2">4.3.2.</a> <a href="#threshold-sha-256-condition-type-fulfillment" id="threshold-sha-256-condition-type-fulfillment">Fulfillment</a></h1>
<pre>
ThresholdSha256FulfillmentPayload ::= SEQUENCE {
  threshold INTEGER (0..4294967295),
  subfulfillments SEQUENCE OF ThresholdSubfulfillment
}

ThresholdSubfulfillment ::= SEQUENCE {
  weight INTEGER (0..4294967295) DEFAULT 1,
  condition Condition OPTIONAL,
  fulfillment Fulfillment OPTIONAL
}
                     </pre>
<p id="rfc.section.4.3.2.p.1">threshold MUST be an integer in the range 1 ... 2^32 - 1. In order to fulfill a threshold condition, the weights of the provided fulfillments MUST be greater than or equal to the threshold.  </p>
<p id="rfc.section.4.3.2.p.2">weight refers to the weight of the condition and must be an integer in the range 1 ... 2^32 - 1.  </p>
<h1 id="rfc.section.4.4"><a href="#rfc.section.4.4">4.4.</a> <a href="#rsa-sha-256-condition-type" id="rsa-sha-256-condition-type">RSA-SHA-256</a></h1>
<p id="rfc.section.4.4.p.1">RSA-SHA-256 is assigned the type ID 3. It relies on the SHA-256 and RSA-PSS feature suites which corresponds to a feature bitmask of 0x11.  </p>
<h1 id="rfc.section.4.4.1"><a href="#rfc.section.4.4.1">4.4.1.</a> <a href="#rsa-sha-256-condition-type-condition" id="rsa-sha-256-condition-type-condition">Condition</a></h1>
<p id="rfc.section.4.4.1.p.1">The fingerprint of a THRESHOLD-SHA-256 condition is the SHA-256 digest of the fingerprint contents given below: </p>
<pre>
RsaSha256FingerprintContents ::= INTEGER (0..MAX) -- modulus
                     </pre>
<p id="rfc.section.4.4.1.p.2">The MODULUS is the RSA public modulus. The public exponent e is set to 65537 as recommended in <a href="#RFC4871">[RFC4871]</a>. Very large exponents can be a DoS vector <a href="#LARGE-RSA-EXPONENTS">[LARGE-RSA-EXPONENTS]</a> and 65537 is the largest Fermat prime, which has some nice properties <a href="#USING-RSA-EXPONENT-OF-65537">[USING-RSA-EXPONENT-OF-65537]</a>.  </p>
<p id="rfc.section.4.4.1.p.3">Implementations MUST reject moduli smaller than 128 bytes (1017 bits) or greater than 512 bytes (4096 bits.) Large moduli slow down signature verification which can be a DoS vector. DNSSEC also limits the modulus to 4096 bits <a href="#RFC3110">[RFC3110]</a>.  OpenSSL supports up to 16384 bits <a href="#OPENSSL-X509-CERT-EXAMPLES">[OPENSSL-X509-CERT-EXAMPLES]</a>.  </p>
<h1 id="rfc.section.4.4.2"><a href="#rfc.section.4.4.2">4.4.2.</a> <a href="#rsa-sha-256-condition-type-fulfillment" id="rsa-sha-256-condition-type-fulfillment">Fulfillment</a></h1>
<pre>
RsaSha256FulfillmentPayload ::= SEQUENCE {
  modulus OCTET STRING (SIZE(128..512)),
  signature OCTET STRING (SIZE(128..512))
}
                     </pre>
<p id="rfc.section.4.4.2.p.1">The signature MUST have the exact same number of octets as the MODULUS, even if that means adding leading zeros. This ensures that the fulfillment size is constant and known ahead of time. Note that the field is still length-prefixed for consistency. Implementations MUST verify that the SIGNATURE and MODULUS consist of the same number of octets. SIGNATURE must be numerically less than MODULUS.  </p>
<p id="rfc.section.4.4.2.p.2">The message to be signed is provided separately by the user. If no message is provided, the message is assumed to be the empty string.  </p>
<h1 id="rfc.section.4.4.3"><a href="#rfc.section.4.4.3">4.4.3.</a> <a href="#rsa-sha-256-condition-type-implementation" id="rsa-sha-256-condition-type-implementation">Implementation</a></h1>
<p id="rfc.section.4.4.3.p.1">The signature algorithm used is RSASSA-PSS as defined in PKCS#1 v2.2.  <a href="#RFC3447">[RFC3447]</a> </p>
<p id="rfc.section.4.4.3.p.2">The recommended modulus size as of 2016 is 2048 bits <a href="#KEYLENGTH-RECOMMENDATION">[KEYLENGTH-RECOMMENDATION]</a>.  In the future we anticipate an upgrade to 3072 bits which provides approximately 128 bits of security <a href="#NIST-KEYMANAGEMENT">[NIST-KEYMANAGEMENT]</a>(p. 64), about the same level as SHA-256.  </p>
<p id="rfc.section.4.4.3.p.3">The salt length for PSS is 32 bytes.  </p>
<h1 id="rfc.section.4.5"><a href="#rfc.section.4.5">4.5.</a> <a href="#ed25519-condition-type" id="ed25519-condition-type">ED25519</a></h1>
<p id="rfc.section.4.5.p.1">ED25519 is assigned the type ID 4. It relies only on the ED25519 feature suite which corresponds to a bitmask of 0x20.  </p>
<p id="rfc.section.4.5.p.2">Ed25519 uses SHA-512 internally, but this specification is not defining the SHA-512 versions of other condition types and we are already adding a feature set which includes this condition type. Therefore we intentionally did not introduce a SHA-512 feature suite in this specification.  </p>
<h1 id="rfc.section.4.5.1"><a href="#rfc.section.4.5.1">4.5.1.</a> <a href="#ed25519-condition-type-condition" id="ed25519-condition-type-condition">Condition</a></h1>
<p id="rfc.section.4.5.1.p.1">The fingerprint of a ED25519 condition is the 32 byte public key.  </p>
<p id="rfc.section.4.5.1.p.2">Since the PUBLIC_KEY is already only 256 bits long and this condition type is not structural, we do not hash it.  </p>
<h1 id="rfc.section.4.5.2"><a href="#rfc.section.4.5.2">4.5.2.</a> <a href="#ed25519-condition-type-fulfillment" id="ed25519-condition-type-fulfillment">Fulfillment</a></h1>
<pre>
Ed25519FulfillmentPayload ::= SEQUENCE {
  publicKey OCTET STRING (SIZE(32)),
  signature OCTET STRING (SIZE(64))
}
                     </pre>
<h1 id="rfc.section.4.5.3"><a href="#rfc.section.4.5.3">4.5.3.</a> <a href="#ed25519-condition-type-implementation" id="ed25519-condition-type-implementation">Implementation</a></h1>
<p id="rfc.section.4.5.3.p.1">The exact algorithm and encodings used for PUBLIC_KEY and SIGNATURE are Ed25519 as defined in <a href="#I-D.irtf-cfrg-eddsa">[I-D.irtf-cfrg-eddsa]</a>. SHA-512 is used as the hashing function.  </p>
<p id="rfc.section.4.5.3.p.2">The PUBLIC_KEY field represents the Ed25519 public key and MUST be 32 bytes in length.  </p>
<p id="rfc.section.4.5.3.p.3">The SIGNATURE field represents the Ed25519 signature and MUST be 64 bytes in length.  </p>
<h1 id="rfc.references"><a href="#rfc.references">5.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">5.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.irtf-cfrg-eddsa">[I-D.irtf-cfrg-eddsa]</b>
      </td>
      <td class="top"><a>Josefsson, S.</a> and <a>I. Liusvaara</a>, "<a href="http://tools.ietf.org/html/draft-irtf-cfrg-eddsa-04">Edwards-curve Digital Signature Algorithm (EdDSA)</a>", Internet-Draft draft-irtf-cfrg-eddsa-04, March 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="ITU.X680.2015">[ITU.X680.2015]</b>
      </td>
      <td class="top"><a>International Telecommunications Union</a>, "<a>Information technology &#8211; Abstract Syntax Notation One (ASN.1): Specification of basic notation</a>", ITU-T Recommendation X.680, 08 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="ITU.X696.2015">[ITU.X696.2015]</b>
      </td>
      <td class="top"><a>International Telecommunications Union</a>, "<a>Information technology &#8211; ASN.1 encoding rules: Specification of Octet Encoding Rules (OER)</a>", ITU-T Recommendation X.696, 08 2015.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC3447">[RFC3447]</b>
      </td>
      <td class="top"><a>Jonsson, J.</a> and <a>B. Kaliski</a>, "<a href="http://tools.ietf.org/html/rfc3447">Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1</a>", RFC 3447, DOI 10.17487/RFC3447, February 2003.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4648">[RFC4648]</b>
      </td>
      <td class="top"><a>Josefsson, S.</a>, "<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>", RFC 4648, DOI 10.17487/RFC4648, October 2006.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">5.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr><td class="reference"><b id="KEYLENGTH-RECOMMENDATION">[KEYLENGTH-RECOMMENDATION]</b></td><td class="top"><a href="https://www.keylength.com/en/compare/">BlueKrypt - Cryptographic Key Length Recommendation</a>", 09 2015.</td>, "</tr>
    <tr><td class="reference"><b id="LARGE-RSA-EXPONENTS">[LARGE-RSA-EXPONENTS]</b></td><td class="top"><a href="https://www.imperialviolet.org/2012/03/17/rsados.html">Imperial Violet - Very large RSA public exponents (17 Mar 2012)</a>", 03 2012.</td>, "</tr>
    <tr><td class="reference"><b id="NIST-KEYMANAGEMENT">[NIST-KEYMANAGEMENT]</b></td><td class="top"><a href="http://csrc.nist.gov/publications/nistpubs/800-57/sp800-57_part1_rev3_general.pdf">NIST - Recommendation for Key Management - Part 1 - General (Revision 3)</a>", 07 2012.</td>, "</tr>
    <tr><td class="reference"><b id="OPENSSL-X509-CERT-EXAMPLES">[OPENSSL-X509-CERT-EXAMPLES]</b></td><td class="top"><a href="http://fm4dd.com/openssl/certexamples.htm">OpenSSL - X509 certificate examples for testing and verification</a>", 07 2012.</td>, "</tr>
    <tr>
      <td class="reference">
        <b id="RFC3110">[RFC3110]</b>
      </td>
      <td class="top"><a>Eastlake 3rd, D.</a>, "<a href="http://tools.ietf.org/html/rfc3110">RSA/SHA-1 SIGs and RSA KEYs in the Domain Name System (DNS)</a>", RFC 3110, DOI 10.17487/RFC3110, May 2001.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4871">[RFC4871]</b>
      </td>
      <td class="top"><a>Allman, E.</a>, <a>Callas, J.</a>, <a>Delany, M.</a>, <a>Libbey, M.</a>, <a>Fenton, J.</a> and <a>M. Thomas</a>, <a href="http://tools.ietf.org/html/rfc4871">DomainKeys Identified Mail (DKIM) Signatures</a>", RFC 4871, DOI 10.17487/RFC4871, May 2007.</td>
    </tr>
    <tr><td class="reference"><b id="USING-RSA-EXPONENT-OF-65537">[USING-RSA-EXPONENT-OF-65537]</b></td><td class="top"><a href="http://crypto.stackexchange.com/questions/3110/impacts-of-not-using-rsa-exponent-of-65537">Cryptography - StackExchange - Impacts of not using RSA exponent of 65537</a>", 11 2014.</td>, "</tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#appendix-a" id="appendix-a">Security Considerations</a></h1>
<p id="rfc.section.A.p.1">TODO </p>
<h1 id="rfc.appendix.B"><a href="#rfc.appendix.B">Appendix B.</a> <a href="#appendix-b" id="appendix-b">Test Values</a></h1>
<p id="rfc.section.B.p.1">TODO </p>
<h1 id="rfc.appendix.C"><a href="#rfc.appendix.C">Appendix C.</a> <a href="#appendix-c" id="appendix-c">ASN.1 Module</a></h1>
<pre>

--&lt;ASN1.PDU CryptoConditions.Condition, CryptoConditions.Fulfillment&gt;--

CryptoConditions
DEFINITIONS
AUTOMATIC TAGS ::=
BEGIN

  /**
   * CONTAINERS
   */

  Condition ::= SEQUENCE {
    type ConditionType,
    featureBitmask OCTET STRING,
    fingerprint OCTET STRING,
    maxFulfillmentLength INTEGER (0..MAX)
  }

  Fulfillment ::= SEQUENCE {
    type ConditionType,
    payload OCTET STRING
  }

  ConditionType ::= INTEGER {
    preimageSha256(0),
    rsaSha256(1),
    prefixSha256(2),
    thresholdSha256(3),
    ed25519(4)
  } (0..65535)

  /**
   * FULFILLMENT PAYLOADS
   */

  -- For preimage conditions, the payload equals the preimage

  PrefixSha256FulfillmentPayload ::= SEQUENCE {
    prefix OCTET STRING,
    subfulfillment Fulfillment
  }

  ThresholdSha256FulfillmentPayload ::= SEQUENCE {
    threshold INTEGER (0..4294967295),
    subfulfillments SEQUENCE OF ThresholdSubfulfillment
  }

  ThresholdSubfulfillment ::= SEQUENCE {
    weight INTEGER (0..4294967295) DEFAULT 1,
    condition Condition OPTIONAL,
    fulfillment Fulfillment OPTIONAL
  }

  RsaSha256FulfillmentPayload ::= SEQUENCE {
    modulus OCTET STRING (SIZE(128..512)),
    signature OCTET STRING (SIZE(128..512))
  }

  Ed25519FulfillmentPayload ::= SEQUENCE {
    publicKey OCTET STRING (SIZE(32)),
    signature OCTET STRING (SIZE(64))
  }

  /**
   * FINGERPRINTS
   */

  -- SHA-256 hash of the fingerprint contents
  Sha256Fingerprint ::= OCTET STRING (SIZE(32)) -- digest

  -- 32-byte Ed25519 public key
  Ed25519Fingerprint ::= OCTET STRING (SIZE(32)) -- publicKey

  /**
   * FINGERPRINT CONTENTS
   *
   * The content that will be hashed to arrive at the fingerprint.
   */

  -- The preimage type hashes the raw contents of the preimage

  PrefixSha256FingerprintContents ::= SEQUENCE {
    prefix OCTET STRING,
    condition Condition
  }

  ThresholdSha256FingerprintContents ::= SEQUENCE {
    threshold INTEGER (0..4294967295),
    subconditions SEQUENCE OF ThresholdSubcondition
  }

  ThresholdSubcondition ::= SEQUENCE {
    weight INTEGER (0..4294967295),
    condition Condition
  }

  RsaSha256FingerprintContents ::= INTEGER (0..MAX) -- modulus

  /**
   * EXAMPLES
   */

  exampleCondition Condition ::=
  {
    type preimageSha256,
    featureBitmask '03'H,
    fingerprint '
      E3B0C442 98FC1C14 9AFBF4C8 996FB924 27AE41E4 649B934C A495991B 7852B855
    'H,
    maxFulfillmentLength 2
  }

  exampleFulfillment Fulfillment ::=
  {
    type preimageSha256,
    payload '00'H
  }

  exampleRsaSha256FulfillmentPayload RsaSha256FulfillmentPayload ::=
  {
    modulus '
      B30E7A93 8783BABF 836850FF 49E14F87 E3F92D5C 46E33FEC A3E4F0B2 2358580B
      11765995 F4B8EEA7 FB4712C2 E1E316F7 F775A953 D232216A 169D9A64 DDC00712
      0A400B37 F2AFC077 B62FE304 DE74DE6A 119EC407 6B529C4F 6096B0BA AD4F533D
      F0173B9B 822FD85D 65FA4BEF A92D8F52 4F69CBCA 0136BD80 D095C169 AEC0E095
    'H,
    signature '
      48E8945E FE007556 D5BF4D5F 249E4808 F7307E29 511D3262 DAEF61D8 8098F9AA
      4A8BC062 3A8C9757 38F65D6B F459D543 F289D73C BC7AF4EA 3A33FBF3 EC444044
      7911D722 94091E56 1833628E 49A772ED 608DE6C4 4595A91E 3E17D6CF 5EC3B252
      8D63D2AD D6463989 B12EEC57 7DF64709 60DF6832 A9D84C36 0D1C217A D64C8625
      BDB594FB 0ADA086C DECBBDE5 80D424BF 9746D2F0 C312826D BBB00AD6 8B52C4CB
      7D47156B A35E3A98 1C973863 792CC80D 04A18021 0A524158 65B64B3A 61774B1D
      3975D78A 98B0821E E55CA0F8 6305D425 29E10EB0 15CEFD40 2FB59B2A BB8DEEE5
      2A6F2447 D2284603 D219CD4E 8CF9CFFD D5498889 C3780B59 DD6A57EF 7D732620
    'H
  }

  exampleEd25519FulfillmentPayload Ed25519FulfillmentPayload ::=
  {
    publicKey '
      EC172B93 AD5E563B F4932C70 E1245034 C35467EF 2EFD4D64 EBF81968 3467E2BF
    'H,
    signature '
      B62291FA D9432F8F 298B9C4A 4895DBE2 93F6FFDA 1A68DADF 0CCDEF5F 47A0C721
      2A5FEA3C DA97A3F4 C03EA9F2 E8AC1CEC 86A51D45 2127ABDB A09D1B6F 331C070A
    'H
  }

END

                </pre>
<h1 id="rfc.appendix.D"><a href="#rfc.appendix.D">Appendix D.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.D.p.1">The editor would like to thank the following individuals for feedback on and implementations of the specification (in alphabetical order): TODO </p>
<h1 id="rfc.appendix.E"><a href="#rfc.appendix.E">Appendix E.</a> <a href="#appendix-d" id="appendix-d">IANA Considerations</a></h1>
<h1 id="rfc.appendix.E.1"><a href="#rfc.appendix.E.1">E.1.</a> <a href="#crypto-conditions-type-registry" id="crypto-conditions-type-registry">Crypto-Condition Type Registry</a></h1>
<p id="rfc.section.E.1.p.1">The following initial entries should be added to the Crypto-Condition Type registry to be created and maintained at (the suggested URI) <a href="http://www.iana.org/assignments/crypto-condition-types">http://www.iana.org/assignments/crypto-condition-types</a>: </p>
<div id="rfc.table.1"/>
<div id="crypto-condition-feature-suites"/>
<p>The following feature suite bits are registered:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <caption>Crypto-Condition Feature Suites</caption>
  <thead>
    <tr>
      <th class="right">Type Bit</th>
      <th class="right">Exp.</th>
      <th class="right">Hex</th>
      <th class="right">Condition Types</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="right">1</td>
      <td class="right">2^0</td>
      <td class="right">0x01</td>
      <td class="right">SHA-256</td>
    </tr>
    <tr>
      <td class="right">10</td>
      <td class="right">2^1</td>
      <td class="right">0x02</td>
      <td class="right">PREIMAGE</td>
    </tr>
    <tr>
      <td class="right">100</td>
      <td class="right">2^2</td>
      <td class="right">0x04</td>
      <td class="right">PREFIX</td>
    </tr>
    <tr>
      <td class="right">1000</td>
      <td class="right">2^3</td>
      <td class="right">0x08</td>
      <td class="right">THRESHOLD</td>
    </tr>
    <tr>
      <td class="right">10000</td>
      <td class="right">2^4</td>
      <td class="right">0x10</td>
      <td class="right">RSA</td>
    </tr>
    <tr>
      <td class="right">100000</td>
      <td class="right">2^5</td>
      <td class="right">0x20</td>
      <td class="right">ED25519</td>
    </tr>
  </tbody>
</table>
<div id="rfc.table.2"/>
<div id="crypto-condition-types"/>
<p>The following types are registered:</p>
<table cellpadding="3" cellspacing="0" class="tt full center">
  <caption>Crypto-Condition Types</caption>
  <thead>
    <tr>
      <th class="right">Type ID</th>
      <th class="right">Required Bitmask</th>
      <th class="right">Type Name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="right">0</td>
      <td class="right">0x03</td>
      <td class="right">PREIMAGE-SHA-256</td>
    </tr>
    <tr>
      <td class="right">1</td>
      <td class="right">0x05</td>
      <td class="right">PREFIX-SHA-256</td>
    </tr>
    <tr>
      <td class="right">2</td>
      <td class="right">0x09</td>
      <td class="right">THRESHOLD-SHA-256</td>
    </tr>
    <tr>
      <td class="right">3</td>
      <td class="right">0x11</td>
      <td class="right">RSA-SHA-256</td>
    </tr>
    <tr>
      <td class="right">4</td>
      <td class="right">0x20</td>
      <td class="right">ED25519</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Author's Address</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Stefan Thomas</span> 
	  <span class="n hidden">
		<span class="family-name">Thomas</span>
	  </span>
	</span>
	<span class="org vcardline">Ripple</span>
	<span class="adr">
	  <span class="vcardline">300 Montgomery Street</span>

	  <span class="vcardline">
		<span class="locality">San Francisco</span>,  
		<span class="region">CA</span> 
		<span class="code">94104</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: -----------------</span>

<span class="vcardline">EMail: <a href="mailto:stefan@ripple.com">stefan@ripple.com</a></span>

<span class="vcardline">URI: <a href="http://www.ripple.com/">http://www.ripple.com/</a></span>

  </address>
</div>

</body>
</html>
